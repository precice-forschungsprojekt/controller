---
# preCICE Configuration Topology for Partitioned Pipe Example
version: 1.0

configuration:
  type: precice
  dimensions: 3

logging:
  enabled: true
  sink:
    filter: "%Severity% > debug and %Rank% = 0"
    format: "---[precice] %ColorizedSeverity% %Message%"

data:
  - name: Pressure
    type: scalar
  - name: Velocity
    type: vector
  # Commented out unused data
  # - name: PressureGradient
  #   type: scalar

meshes:
  - name: Fluid1-Mesh
    dimensions: 3
    data: 
      - Pressure
      - Velocity
      # - PressureGradient

  - name: Fluid2-Mesh
    dimensions: 3
    data: 
      - Pressure
      - Velocity
      # - PressureGradient

participants:
  - name: Fluid1
    provides_mesh: 
      - Fluid1-Mesh
    receives_mesh:
      - name: Fluid2-Mesh
        from: Fluid2
    writes_data:
      - name: Velocity
        mesh: Fluid1-Mesh
      # - name: PressureGradient
      #   mesh: Fluid1-Mesh
    reads_data:
      - name: Pressure
        mesh: Fluid1-Mesh
    mapping:
      - type: nearest-neighbor
        direction: read
        from_mesh: Fluid2-Mesh
        to_mesh: Fluid1-Mesh
        constraint: consistent

  - name: Fluid2
    provides_mesh: 
      - Fluid2-Mesh
    receives_mesh:
      - name: Fluid1-Mesh
        from: Fluid1
    reads_data:
      - name: Velocity
        mesh: Fluid2-Mesh
      # - name: PressureGradient
      #   mesh: Fluid2-Mesh
    writes_data:
      - name: Pressure
        mesh: Fluid2-Mesh
    mapping:
      - type: nearest-neighbor
        direction: read
        from_mesh: Fluid1-Mesh
        to_mesh: Fluid2-Mesh
        constraint: consistent

communication:
  type: sockets
  acceptor: Fluid1
  connector: Fluid2
  exchange_directory: ..

coupling_scheme:
  type: serial-implicit
  time_window_size: 0.01
  max_time: 1.0
  max_iterations: 100
  participants:
    - first: Fluid1
    - second: Fluid2
  data_exchange:
    - data: Velocity
      mesh: Fluid1-Mesh
      from: Fluid1
      to: Fluid2
    # - data: PressureGradient
    #   mesh: Fluid1-Mesh
    #   from: Fluid1
    #   to: Fluid2
    - data: Pressure
      mesh: Fluid2-Mesh
      from: Fluid2
      to: Fluid1
  convergence_measures:
    - data: Pressure
      mesh: Fluid2-Mesh
      type: relative
      limit: 1.0e-6
    - data: Velocity
      mesh: Fluid1-Mesh
      type: relative
      limit: 1.0e-6
  acceleration:
    type: IQN-ILS
    data:
      - name: Pressure
        mesh: Fluid2-Mesh
    initial_relaxation: 0.01
    max_used_iterations: 80
    time_windows_reused: 10
    filter:
      type: QR1
      limit: 1e-8

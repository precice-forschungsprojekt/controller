---
# preCICE Configuration Topology for Partitioned Heat Conduction Example
version: 1.0

configuration:
  type: precice
  dimensions: 2

logging:
  enabled: true
  sink:
    filter: "%Severity% > debug and %Rank% = 0"
    format: "---[precice] %ColorizedSeverity% %Message%"

data:
  - name: Temperature
    type: scalar
    waveform_degree: 1
  - name: Heat-Flux
    type: scalar
    waveform_degree: 1

meshes:
  - name: Dirichlet-Mesh
    dimensions: 2
    data: 
      - Temperature
      - Heat-Flux

  - name: Neumann-Mesh
    dimensions: 2
    data: 
      - Temperature
      - Heat-Flux

participants:
  - name: Dirichlet
    provides_mesh: 
      - Dirichlet-Mesh
    receives_mesh:
      - name: Neumann-Mesh
        from: Neumann
    writes_data:
      - name: Heat-Flux
        mesh: Dirichlet-Mesh
    reads_data:
      - name: Temperature
        mesh: Dirichlet-Mesh
    mapping:
      - type: nearest-neighbor
        direction: read
        from_mesh: Neumann-Mesh
        to_mesh: Dirichlet-Mesh
        constraint: consistent

  - name: Neumann
    provides_mesh: 
      - Neumann-Mesh
    receives_mesh:
      - name: Dirichlet-Mesh
        from: Dirichlet
    writes_data:
      - name: Temperature
        mesh: Neumann-Mesh
    reads_data:
      - name: Heat-Flux
        mesh: Neumann-Mesh
    mapping:
      - type: nearest-neighbor
        direction: read
        from_mesh: Dirichlet-Mesh
        to_mesh: Neumann-Mesh
        constraint: consistent

communication:
  type: sockets
  acceptor: Dirichlet
  connector: Neumann
  exchange_directory: ..

coupling_scheme:
  type: serial-implicit
  max_time: 1.0
  time_window_size: 0.1
  max_iterations: 100
  participants:
    - first: Dirichlet
    - second: Neumann
  data_exchange:
    - data: Heat-Flux
      mesh: Dirichlet-Mesh
      from: Dirichlet
      to: Neumann
      initialize: true
      substeps: true
    - data: Temperature
      mesh: Neumann-Mesh
      from: Neumann
      to: Dirichlet
      initialize: true
      substeps: true
  convergence_measures:
    - data: Heat-Flux
      mesh: Dirichlet-Mesh
      type: relative
      limit: 1e-10
    - data: Temperature
      mesh: Neumann-Mesh
      type: relative
      limit: 1e-10
  acceleration:
    type: constant
    relaxation: 0.5
    # Commented out IQN-ILS configuration
    # type: IQN-ILS
    # initial_relaxation: 0.1
    # max_used_iterations: 10
    # time_windows_reused: 5
    # filter:
    #   type: QR2
    #   limit: 1e-3
